<?xml version="1.0" encoding="UTF-8"?>
<configuration>

	<springProperty scope="context" name="cdrEnabled" source="OPENVIDU_CDR" defaultValue="false" />
	<springProperty scope="context" name="cdrPath" source="OPENVIDU_CDR_PATH" defaultValue="/opt/openvidu/cdr" />
	<springProperty scope="context" name="logging.colors" source="logging.colors" defaultValue="false" />
	<timestamp key="myTimestamp" timeReference="contextBirth" datePattern="HH-mm-ss" />

	<if condition='property("logging.colors").equalsIgnoreCase("true")'>
		<then>
			<appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
				<encoder>
					<pattern>%black(%highlight([%p]) %d{dd MMM HH:mm:ss.SSS} %magenta([%.80t]) \(%file:%line\) - %msg%n)</pattern>
				</encoder>
			</appender>
		</then>
	</if>

	<if condition='!property("logging.colors").equalsIgnoreCase("true")'>
		<then>
			<appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
				<encoder>
					<pattern>[%p] %d [%.80t] %c - %msg%n</pattern>
				</encoder>
			</appender>
		</then>
	</if>

	<!--
	<appender name="CUSTOMCLASS"
		class="ch.qos.logback.core.ConsoleAppender">
		<encoder>
			<pattern>%highlight([%p]) %d %magenta([%.15t]) %boldGreen(%c \(%M\) - %msg%n)
			</pattern>
		</encoder>
	</appender>
	<logger
		name="io.openvidu.server.kurento.core.KurentoSessionManager">
		<appender-ref ref="CUSTOMCLASS" />
	</logger>
	-->

	<logger name="org.kurento.jsonrpc.client" level="error">
		<appender-ref ref="STDOUT" />
	</logger>

	<root level="info">
		<appender-ref ref="STDOUT" />
	</root>

	<if condition='property("cdrEnabled").equalsIgnoreCase("true")'>
		<then>
			<appender name="CDR" class="ch.qos.logback.core.rolling.RollingFileAppender">
				<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
					<FileNamePattern>${cdrPath}/CDR.%d{yyyy-MM-dd}_${myTimestamp}.log
					</FileNamePattern>
					<MaxHistory>30</MaxHistory>
					<TotalSizeCap>20GB</TotalSizeCap>
				</rollingPolicy>
				<encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
					<charset>UTF-8</charset>
					<pattern>%m\n</pattern>
				</encoder>
			</appender>
			<logger name="io.openvidu.server.cdr.CDRLoggerFile" level="info">
				<appender-ref ref="CDR" />
			</logger>
		</then>
	</if>

</configuration>